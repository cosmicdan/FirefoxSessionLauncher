<html>
<head>
	<HTA:APPLICATION 
		APPLICATIONNAME="Firefox SessionSwapper"
		VERSION="1.0.0"
		ID="FirefoxSessionSwapper"
		ICON="SessionSwapper.ico"
		BORDER="none"
		CAPTION="no"
		CONTEXTMENU="no"
		INNERBORDER="no"
		SCROLLFLAT="yes"
		SCROLL="yes"
		SINGLEINSTANCE="yes"
		SELECTION="no"
		SYSMENU="no"
	>
	<title>Firefox SessionSwapper</title>
	<link rel="stylesheet" type="text/css" href="SessionSwapper.css" />
	
	
	<script language="JavaScript">
		var ws = new ActiveXObject("WScript.Shell");
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		
		var sessionSwapperStorageDir = ws.ExpandEnvironmentStrings("%SESSIONSWAPPER_STORAGE%");
		// sanity check - dont allow running manually
		if (sessionSwapperStorageDir === "" || !fso.FolderExists(sessionSwapperStorageDir)) {
			alert("The SessionSwapper GUI cannot be run manually.");
			window.close();
		}
		var sessionSwapperStorageObj = fso.GetFolder(sessionSwapperStorageDir);
		var defaultSessionName = ws.ExpandEnvironmentStrings("%DEFAULT_SESSION_NAME%");

		window.onload = function() {
			var width = screen.width / 3.5;
			var height = screen.height / 1.6;
			window.resizeTo(width, height);
			window.moveTo(((screen.width - width) / 2), ((screen.height - height) / 2));
			// start building html
			var guiSessionList = document.getElementById("sessionSwapperGuiSessionList");
			
			// always add _Default to the top
			addSessionButton(guiSessionList, defaultSessionName);
			
			// add any other sessions
			var sessionEnumerator = new Enumerator(sessionSwapperStorageObj.SubFolders);
			for (; !sessionEnumerator.atEnd(); sessionEnumerator.moveNext()) {
				var sessionName = sessionEnumerator.item().Name;
				if (sessionName != defaultSessionName) {
					addSessionButton(guiSessionList, sessionName);
				}
			}
			
			// footer
			var guiFooter = document.getElementById("sessionSwapperGuiFooter");
			guiFooter.innerHTML += "<button style='footerButton' onclick='openSessionDirectory()'>Open SessionSwapper dir</button>";
			
			// setup hover stuff
			var sessionChoiceButtons = document.getElementsByName('sessionChoice');
			for(var i = 0, j = sessionChoiceButtons.length; i < j; i++) {
				sessionChoiceButtons[i].onmouseover = function() {
					this.className = "sessionChoice_hover";
				}
				sessionChoiceButtons[i].onmouseout = function() {
					this.className = "sessionChoice";
				}
			}
		}

		function addSessionButton(guiSessionList, sessionName) {
			guiSessionList.innerHTML += "<button name='sessionChoice' class='sessionChoice' onclick=\"selectSession('" + sessionName + "')\">" + sessionName + "</button>";
		}

		function selectSession(sessionName) {
			fso.GetStandardStream(1).WriteLine(sessionName);
			window.close();
		}

		function openSessionDirectory() {
			ws.run("Explorer /n, /e, " + sessionSwapperStorageDir);
		}
	</script>
</head>

<body>
<center><table>
	<thead>
		<tr><th>
			<h1 class="title"><img src="SessionSwapper.png"</img>SessionSwapper</h1>
			<h2>Select a session, or create a new one.</h2>
		</th></tr>
	</thead>
	<tbody>
		<tr align="center">
			<td valign="top">
				<div id="sessionSwapperGuiSessionList"></div>
			</td>
		</tr>
	</tbody>
	<tfoot>
		<tr><td><div id="sessionSwapperGuiFooter"></div></td></tr>
	</tfoot>
</table></center>
</BODY>
</HTML>

